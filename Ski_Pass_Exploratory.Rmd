---
title: "Ski Pass Exploratory"
author: "Winston Saunders"
date: "March 26, 2015"
output: 
   html_document:
        toc: true
        toc_depth: 3
---

```{r global_options, include=FALSE}
knitr::opts_chunk$set(fig.width=6, fig.height=3, fig.align='center', fig.path='Figs/', echo=FALSE, warning=FALSE, message=FALSE)
```


```{r}
        ## PASS NUMBER
        Pass <- "MBA6360970"

        Directory <- "/Users/winstonsaunders/Documents/Ski_Data2/"
        
        ski_runs<-read.csv(paste0(Directory,Pass,".csv"))

        Pass_Code<-gsub("6", "X", Pass)
        Pass_Code<-gsub("A", "X", Pass_Code)
        Pass_Code<-gsub("0", "X", Pass_Code)

```

##Download Data from Pass `r Pass_Code`

```{r}

        head(ski_runs[,2:8])


```

Let's look at a sample of the ski runs data:

```{r, echo=TRUE}
print_sample<-sort(sample(1:dim(ski_runs)[1], 15))
print(ski_runs[print_sample,1:3])
```

From this data add a few extra columns of data as a start of features such as weekday, weekend, and holiday indicators.

```{r}
library(timeDate)
library(chron)

ski_runs$weekend<-isWeekend(ski_runs$date)
ski_runs$holiday<-isHoliday(as.timeDate(ski_runs$date), holidays = holidayNYSE(), wday = 1:5)
ski_runs$bizday<-isBizday(as.timeDate(ski_runs$date))
```


##Daily vertical

```{r "compute daily vert"}
## calculate daily vertical sums
daily_vert<-rowsum(ski_runs$vertical_feet, ski_runs$date)
daily_vert<-as.data.frame(daily_vert)
daily_vert$date<-rownames(daily_vert)


daily_vert <- transform(daily_vert,
                        week = as.POSIXlt(date)$yday %/% 7 + 1,
                        season_week = (as.POSIXlt(date)$yday+61)%%365 %/% 7+1,
                        wday = as.POSIXlt(date)$wday,
                        year = as.POSIXlt(date)$year+1900)

colnames(daily_vert)<-c("total_vertical","date","week","season_week" ,"wday","year")
```

```{r}
library(ggplot2)
p<-ggplot(daily_vert, aes(x=season_week, y= total_vertical)) + 
  geom_point(size=3) + geom_smooth()
  
print(p)
```

```{r}
library(ggplot2)
p<-ggplot(daily_vert, aes(x= total_vertical)) + 
  geom_histogram(colour = "darkgreen", fill = "khaki4", binwidth = 2000, aes(y=..count..)) 
  
print(p)

```

```{r "get rid of scientific notation"}
options(scipen=999)
```

The mean vertical is `r round(mean(daily_vert$total_vertical),0)` feet over `r dim(daily_vert)[1]` days.

##Visual Summary of Ski Seasons for `r Pass_Code`



```{r, fig.align='center', fig.height=9, fig.width=6}
library(ggplot2)
p1<-ggplot(daily_vert, aes(week, wday, fill = total_vertical)) + 
  geom_tile(colour = "white") +
  scale_fill_gradientn(colours = c("khaki2", "darkgreen", "red")) + 
  facet_wrap(~ year, ncol = 1)

print(p1)
