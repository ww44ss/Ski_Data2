---
title: "Ski Pass Exploratory"
author: "Winston Saunders"
date: "March 26, 2015"
output: 
   html_document:
        toc: true
        toc_depth: 3
---

```{r global_options, include=FALSE}
knitr::opts_chunk$set(fig.width=6, fig.height=3, fig.align='center', fig.path='Figs/', echo=FALSE, warning=FALSE, message=FALSE)
```


```{r}
        ## PASS NUMBER
        Pass <- "MBA6360970"

        Directory <- "/Users/winstonsaunders/Documents/Ski_Data2/"
        
        ski_runs<-read.csv(paste0(Directory,Pass,".csv"))

        Pass_Code<-"MBXXXXXXXX"

```

##Download Data from Pass `r Pass_Code`

Data are extracted from the [Track Your Turns](http://track.mtbachelor.com/index.asp) website at [Mt. Bachelor](http://www.mtbachelor.com/site). For this particular pass there are `r dim(ski_runs)[1]` total runs. 

Let's look at a sample of the ski runs data:

```{r, echo=TRUE}
print_sample<-sort(sample(1:dim(ski_runs)[1], 15))
print(ski_runs[print_sample,2:8])
```

From this data add a few extra columns of data as a start of features such as weekday, weekend, and holiday indicators to increase the feature set available for plotting. 

```{r}
library(timeDate)
library(chron)

ski_runs$weekend<-isWeekend(ski_runs$date)
ski_runs$holiday<-isHoliday(as.timeDate(ski_runs$date), holidays = holidayNYSE(), wday = 1:5)
ski_runs$bizday<-isBizday(as.timeDate(ski_runs$date))
```


##Daily vertical

We can slice and dice the data many ways. One way, as below, is to sum vertical feet of runs to get total vertical feet skied per day. From there we can look variosu distributions. 

```{r "compute daily vert", echo=2}
## calculate daily vertical sums
daily_vert<-rowsum(ski_runs$vertical_feet, ski_runs$date)
daily_vert<-as.data.frame(daily_vert)
daily_vert$date<-rownames(daily_vert)


daily_vert <- transform(daily_vert,
                        week = as.POSIXlt(date)$yday %/% 7 + 1,
                        season_week = (as.POSIXlt(date)$yday+61)%%365 %/% 7+1,
                        wday = as.POSIXlt(date)$wday,
                        year = as.POSIXlt(date)$year+1900)

colnames(daily_vert)<-c("total_vertical","date","week","season_week" ,"wday","year")
```

A first analysis, as below, shows the daily total vert plotted as a function of "Ski Season Week" (i.e. weeks since Nov 1). The one point at week 40 is a high snow year, when they area opened on July 4th. 


```{r}
library(ggplot2)
p<-ggplot(daily_vert, aes(x=season_week, y= total_vertical)) + 
  geom_point(size=3) + geom_smooth()
  
print(p)
```
Another way to look at the data is as a histogram of daily total vertical for all ski days. 
```{r}
library(ggplot2)
p<-ggplot(daily_vert, aes(x= total_vertical)) + 
  geom_histogram(colour = "darkgreen", fill = "khaki4", binwidth = 2000, aes(y=..count..)) 
  
print(p)

```

```{r "get rid of scientific notation"}
options(scipen=999)
```

The mean vertical is `r round(mean(daily_vert$total_vertical),0)` feet over `r dim(daily_vert)[1]` days.

##Visual Summary of Ski Seasons for `r Pass_Code`

This is an interesting way to look at individual ski days. Vertical feet for the day are encoded in color, with red representing the highest dailty vert. 

```{r, fig.align='center', fig.height=9, fig.width=6}
library(ggplot2)
p1<-ggplot(daily_vert, aes(week, wday, fill = total_vertical)) + 
  geom_tile(colour = "white") +
  scale_fill_gradientn(colours = c("khaki2", "darkgreen", "red")) + 
  facet_wrap(~ year, ncol = 1)

print(p1)
```

####Chair lift totals

Here we begin to look at the data in somewhat finer detail. For instance we can look at the total vertical feet skied on a particular chairlift per ski day.  

For the Pine Marten chair lift.  


```{r "compute daily Pine vert", echo=2}
## calculate daily vertical sums
Pine_runs <- ski_runs[ski_runs$chair=="Pine Marten",]
daily_vert<-rowsum(Pine_runs$vertical_feet, Pine_runs$date)
daily_vert<-as.data.frame(daily_vert)
daily_vert$date<-rownames(daily_vert)


daily_vert <- transform(daily_vert,
                        week = as.POSIXlt(date)$yday %/% 7 + 1,
                        season_week = (as.POSIXlt(date)$yday+61)%%365 %/% 7+1,
                        wday = as.POSIXlt(date)$wday,
                        year = as.POSIXlt(date)$year+1900)

colnames(daily_vert)<-c("total_vertical","date","week","season_week" ,"wday","year")
```


```{r, fig.height=8}
library(ggplot2)
p<-ggplot(daily_vert, aes(x=week, y= total_vertical, color=factor(wday))) + 
  geom_point(size=3) + ggtitle("Pine Marten") +facet_grid(year~.)
  
print(p)
```


```{r "compute daily Sunrise vert", echo=2}
## calculate daily vertical sums
Sunrise_runs <- ski_runs[ski_runs$chair=="Sunrise",]
daily_vert<-rowsum(Pine_runs$vertical_feet, Pine_runs$date)
daily_vert<-as.data.frame(daily_vert)
daily_vert$date<-rownames(daily_vert)


daily_vert <- transform(daily_vert,
                        week = as.POSIXlt(date)$yday %/% 7 + 1,
                        season_week = (as.POSIXlt(date)$yday+61)%%365 %/% 7+1,
                        wday = as.POSIXlt(date)$wday,
                        year = as.POSIXlt(date)$year+1900)

daily_vert$count<-1:dim(daily_vert)[1]

colnames(daily_vert)<-c("total_vertical","date","week","season_week" ,"wday","year", "count")
```


```{r, fig.height=4}
library(ggplot2)
p<-ggplot(daily_vert, aes(x=count, y= total_vertical, color=factor(wday))) + 
  geom_point(size=3) + ggtitle("Sunrise")
  
print(p)
```

###Chairlift Usage

We can look if there are patterns in the charilift usage by looking for trends and patterns in the data on which chairs are ridden...

####Chairlift Frequency

First, let's just look at the number of rides on all chairs

```{r, fig.height=5}

chair_table<-table(ski_runs$chair)

barplot(sort(chair_table, decreasing=TRUE), cex.names=.9, las=2)
```

We can use this to test each day against this pattern...




